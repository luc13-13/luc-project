# LUC-PROJECT 项目文档

## 项目概述

### 项目简介
LUC-PROJECT 是一个基于 SpringBoot3、Spring Authorization Server 1.1、Java17 的企业级后台管理系统和多租户服务框架。该项目采用微服务架构，提供统一的认证授权服务平台。

### 技术栈
- **Java**: 21
- **Spring Boot**: 3.5.6
- **Spring Cloud**: 2025.0.0
- **Spring Cloud Alibaba**: 2023.0.1.0
- **数据库**: MySQL 8
- **ORM框架**: MyBatis-Plus 3.5.13
- **API文档**: SpringDoc OpenAPI 2.8.9
- **缓存**: Redis
- **连接池**: Druid 1.2.20
- **工具库**: hutool 5.8.28

## 项目架构

### 整体架构
项目采用微服务架构，主要由以下几个核心模块组成：

1. **开发脚手架** (luc-framework)
2. **认证授权中心** (authorization-server)
3. **鉴权网关** (authorization-gateway)  
4. **系统管理微服务** (luc-system)
5. **产品中心微服务** (product-center)

### 模块结构

```
luc-project/
├── luc-framework/                    # 开发脚手架
│   ├── framework-apidoc/             # API文档模块
│   ├── framework-core/               # 核心模块
│   ├── framework-data-permission/    # 数据权限模块
│   ├── framework-datasource-starter/ # 动态数据源模块
│   ├── framework-excel/              # Excel处理模块
│   ├── framework-redis-starter/      # Redis缓存模块
│   ├── framework-security/           # 安全认证模块
│   ├── framework-storage/            # S3文件存储模块
│   └── framework-web/                # Web基础模块
├── authorization-gateway/            # 认证网关
├── authorization-server/             # 认证服务器
├── luc-system/                       # 系统核心服务luc-system，包含用户、菜单、权限等管理
│   ├── system-api/                   # API
│   └── system-boot/                  # 启动模块
|—— product-center/                   # 产品管理服务product-center，包含产品定义、产品营销策略
│   ├── product-center-api/           # API
│   └── product-center-boot/          # 启动模块
└── .other/                           # 项目部署
│   ├── consul/                       # cnosul备份
│   ├── db/                           # 数据库定义和初始化脚本
│   ├── docker/                       # docker脚本
│   ├── mvn/                          # mvn配置文件
│   └── nacos/                        # nacos配置文件备份，已弃用
```

## 核心模块详解

### 1. 开发脚手架 (luc-framework)

#### framework-core (核心模块)
- **WebResult**: 统一响应结果封装
- **BizException**: 业务异常处理
- **StatusConstants**: 状态码常量定义
- **分页参数**: PaginationParams

#### framework-security (安全模块)
- **LoginUserDetail**: 登录用户信息封装
- **ResourceServerAutoConfiguration**: 资源服务器自动配置
- **Feign拦截器**: 服务间调用安全传递

#### framework-datascope (数据权限模块)
- **@DataScope**: 数据权限注解
- **DataScopeInterceptor**: 数据权限拦截器
- **多种权限处理器**: 租户、用户、角色权限

#### framework-datasource-starter (动态数据源模块)
- **DynamicDataSource**: 动态数据源实现
- **多数据源配置**: 支持主从、分库分表
- **Druid连接池**: 数据库连接池管理

#### framework-redis-starter (Redis模块)
- **RedisHelper**: Redis操作工具类
- **缓存管理**: 统一缓存前缀和过期时间
- **序列化配置**: JSON和字节序列化支持

#### framework-excel (Excel模块)
- **EasyExcelUtils**: Excel导入导出工具
- **注解支持**: 字段映射和格式化
- **流式处理**: 大数据量Excel处理

#### framework-storage (文件存储模块)
- **多平台支持**: 七牛云、阿里云OSS、AWS S3
- **统一接口**: 文件上传、下载、删除
- **配置化管理**: 多bucket配置

#### framework-web (Web基础模块)
- **GlobalExceptionHandler**: 全局异常处理
- **Feign配置**: 服务间调用配置
- **热部署支持**: 开发环境自动重启

#### framework-apidoc (API文档模块)
- **SpringDoc集成**: OpenAPI 3.0 文档生成
- **Swagger UI**: 在线API测试
- **多服务聚合**: 网关层文档聚合

### 2. 认证授权模块 (authorization-server)

**功能特性:**
- 基于 Spring Authorization Server 实现 OAuth2.0 认证流程
- 支持多种登录方式：用户名密码、短信验证码、Gitee登录、微信登录
- 开启csrf
- redis + JWT Token 管理，token签发与续期
- 客户端注册管理

**主要接口:**
- `/getInfo` - 获取当前登录用户信息
- `/menu/getRouters` - 获取用户菜单路由
- `/oauth2/token` - OAuth2 Token 获取
- `/client/register` - 客户端注册

**配置信息:**
- 端口: 8889
- 数据库: authorization_server
- Redis缓存支持

### 3. 鉴权网关 (authorization-gateway)

**功能特性:**
- 基于 Spring Cloud Gateway 实现统一网关
- 路由转发和负载均衡
- 统一鉴权和权限控制
- 验证码服务
- API文档聚合

**路由配置:**
- `/luc-system/**` → luc-system 服务
- `/auth-server/**` → auth-server 服务
- `/product-center/**` → product-center 服务

**安全配置:**
- 白名单路径配置
- JWT Token 验证
- CORS 跨域支持

### 4. 系统管理服务 (luc-system)

**功能特性:**
- 账号管理
- 租户管理、租户配额管理
- 角色管理
- 菜单权限管理
- 机构管理
- Feign 服务调用

**配置信息:**
- 端口: 19003
- 数据库: luc_system

### 5. 产品服务 (product-center)

**功能特性:**
- 产品管理
- 营销方案管理
- 产品目录分为四个层级，产品、子产品、配置项、子配置项，用于定义所有实例资源、iaas资源

**配置信息:**
- 端口: 19004
- 数据库: product_center


## 认证与鉴权机制

### 认证流程
1. 用户通过 authorization-gateway 统一访问系统
2. 请求头携带 `x-access-token` 标识已登录用户
3. authorization-gateway 和 authorization-server 通过 `x-access-token` 从 Redis 获取安全上下文和 JWT Token
4. authorization-server 支持 OAuth2.0 认证流程，扩展多种登录方式

### 权限控制
- **数据权限**: 基于 @DataScope 注解实现行级数据权限
- **功能权限**: 基于角色和权限的访问控制
- **租户隔离**: 多租户数据隔离机制

## 开发规范

### 项目命名规则
1. **脚手架项目**: framework-【功能简写】
2. **基础服务**: 【系统】-system
3. **认证服务**: auth-【功能】
4. **核心业务服务**: 【服务】-center
5. **小程序服务**: mini-app-【小程序名称】

### Maven配置
- 遵循 Maven 最小化配置原则
- 使用父项目进行版本和依赖管理
- 统一版本号管理: ${revision}

### 代码规范
- 使用 Lombok 简化代码
- 统一异常处理机制
- RESTful API 设计规范
- 统一响应格式

## 部署配置

### 环境要求
- JDK 21+
- Maven 3.6.3+
- MySQL 8.0+
- Redis 6.0+
- Nacos (可选)
- consul

### 数据库配置
- **authorization-server**: authorization_server 数据库 
- **luc-system**: [](.other/db/luc_system.sql)

### Redis配置
- 主机: 127.0.0.1
- 端口: 6379
- 密码: luc123456
- 数据库: 0

### 服务端口
- **auth-server**: 8889
- **auth-gateway**: 8809 (默认)
- **luc-system**: 19003

## 快速启动

### 1. 环境准备
```bash
# 启动 MySQL
# 启动 Redis
# 创建数据库
```

### 2. 配置修改
- 修改各服务的数据库连接配置
- 修改 Redis 连接配置
- 配置文件存储参数（如需要）

### 3. 启动顺序
1. 启动 auth-server
2. 启动 luc-system
3. 启动 auth-gateway

### 4. 访问验证
- API文档: http://localhost:8809/doc.html
- 认证服务: http://localhost:8889
- 系统服务: http://localhost:8809/luc-system

## API文档

项目集成了 SpringDoc OpenAPI，提供完整的 API 文档：
- **在线文档**: http://localhost:8809/doc.html
- **OpenAPI JSON**: http://localhost:8809/v3/api-docs
- **认证配置**: 支持 OAuth2 Token 认证测试

## 监控与日志

### 日志配置
- 使用 Logback 作为日志框架
- 支持多环境日志配置
- 集成 Plumelog 日志收集（可选）

### 监控指标
- 数据库连接池监控
- Redis 连接监控
- 服务健康检查

## 扩展功能

### 文件存储
- 支持本地存储
- 支持七牛云存储
- 支持阿里云OSS
- 支持AWS S3

### 数据权限
- 租户级数据隔离
- 部门级数据权限
- 用户级数据权限
- 自定义权限规则

### Excel处理
- 大数据量导入导出
- 自定义格式化
- 模板下载
- 异步处理

## 技术特色

1. **微服务架构**: 模块化设计，易于扩展和维护
2. **统一认证**: 基于 OAuth2.0 的统一认证授权
3. **数据权限**: 灵活的行级数据权限控制
4. **动态数据源**: 支持读写分离和分库分表
5. **文档完善**: 自动生成API文档，支持在线测试
6. **开发友好**: 热部署、代码生成、统一异常处理

## 版本信息

- **当前版本**: 1.0.0
- **最后更新**: 2024年
- **维护状态**: 活跃开发中

---

*本文档基于项目源码自动生成，如有疑问请参考源码或联系开发团队。*
